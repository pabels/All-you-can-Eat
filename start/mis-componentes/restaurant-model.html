<polymer-element name="restaurant-model">
  <template>
  </template>


 <script>



(function() {

	var base = '/restaurants/';
	var restaurants;
	
	Polymer('restaurant-model', {
		created: function() {
			if (!restaurants) {
				doAjax({}, function(data) {


					data.reverse();
        			restaurants= data;
					this.restaurants = restaurants; // sirve para q la var restaurants sea accesible desde fuera de restaurant model
				}.bind(this));
			}
		},

		newRestaurant: function(detail) {
			doAjax({type: 'POST', data: JSON.stringify(detail)}, function(data,status) {
				restaurants.unshift(data);
			
			}.bind(this));
		},
		deleteRestaurant: function(restaurant){
			doAjax({type: 'DELETE', url: restaurant._id}, function(data,status){
				
				var i = this.restaurants.indexOf(data);

						if (i >= 0) {
							this.restaurants.splice(i, 1);
						}	
			
			}.bind(this));
		

			var i = this.restaurants.indexOf(restaurant);
						if (i >= 0) {
							this.restaurants.splice(i, 1);
						}	
			

		
		},

		setRestaurant: function(restaurantFav) {
			
			var url =  restaurantFav._id;
			var data = {
				name : restaurantFav.name,
		        paragraph : restaurantFav.paragraph,
		        type: restaurantFav.type,
		        direction: restaurantFav.direction,
		        menu:restaurantFav.menu,
		        favoriteCard:  true,
		        _id : restaurantFav._id,

			};
			var i=0;
			while( restaurants[i]._id != data._id && i<restaurants.length){
				console.log(restaurants[i]._id +"==="+ data._id);
				i++;
			}
			if(localStorage.token){
			restaurants[i]=data;	
			}
			
			doAjax({type: 'PUT', url: url, data: JSON.stringify(data)}, function() {}.bind(this));
		},

		updateRestaurant: function(data){

				var url =  data._id;
			
						var i=0;
						while(restaurants[i]._id != data._id && i<restaurants.length){
							
							i++;
						}
						if(localStorage.token){
						this.restaurants[i]=data;	
						}

		
				doAjax({type: 'PUT', url: url, data: JSON.stringify(data)}, function(data,status) {
						

				}.bind(this));



		}
	});
}());
    </script>


</polymer-element>