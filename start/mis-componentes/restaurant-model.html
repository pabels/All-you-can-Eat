<polymer-element name="restaurant-model">
  <template>
  </template>


 <script>



(function() {

	var base = '/restaurants/';
	var restaurants;
	var topRestaurants;

	Polymer('restaurant-model', {
		created: function() {
			if (!restaurants) {
				doAjax({}, function(data) {


					data.reverse();
        			restaurants= data;
        			topRestaurants = data.map(function(rest){
        				if(rest.comments.length > 2){
        					return rest;
        				}
        			});
					this.restaurants = restaurants; 
					this.topRestaurants = topRestaurants;
					// sirve para q la var restaurants sea accesible desde fuera de restaurant model
				}.bind(this));
			}
		},

		newRestaurant: function(detail) {
			doAjax({type: 'POST', data: JSON.stringify(detail)}, function(data,status) {
				restaurants.unshift(data);
			
			}.bind(this));
		},
		deleteRestaurant: function(restaurant){
			doAjax({type: 'DELETE', url: restaurant._id}, function(data,status){
				
				var i = this.restaurants.indexOf(data);

						if (i >= 0) {
							this.restaurants.splice(i, 1);
						}	
			
			}.bind(this));
		

			var i = this.restaurants.indexOf(restaurant);
						if (i >= 0) {
							this.restaurants.splice(i, 1);
						}	
			

		
		},

		

		updateRestaurant: function(data){

				var url =  data._id;
			
						var i=0;
						while(restaurants[i]._id != data._id && i<restaurants.length){
							
							i++;
						}
						if(localStorage.token){
						this.restaurants[i]=data;	
						}
					
						this.topRestaurants = this.restaurants.map(function(rest){
        				if(rest.comments.length > 2){
        					return rest;
        				}
        				});

		
				doAjax({type: 'PUT', url: url, data: JSON.stringify(data)}, function(data,status) {
						

				}.bind(this));



		}
	});
}());
    </script>


</polymer-element>